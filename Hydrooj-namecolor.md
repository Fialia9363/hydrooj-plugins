# 🌈 Hydro NameColor Pro v1.0

为 **HydroOJ v5.0.0-beta.9+** 打造的高级用户名颜色管理插件。  
允许管理员为用户和用户组设置个性化的显示颜色，并支持实时预览、自动补全、内联编辑和批量设置。

---

## ✨ 功能特性

| 功能 | 描述 |
|------|------|
| 👑 管理员专属面板 | 仅管理员可访问 `/admin/namecolor` |
| 🧍 用户颜色设置 | 为任意用户设置专属名字颜色 |
| 👥 用户组颜色设置 | 为整个用户组批量设置颜色（如管理员红色、出题人蓝色） |
| 🎨 实时预览 | 修改颜色时即时预览效果 |
| 🔍 自动补全 | 输入用户名或 UID 自动提示候选项 |
| ⚡ 内联编辑 | 点击表格中的颜色块可直接修改并自动保存（AJAX） |
| 🧠 渲染增强 | 用户未设置颜色时自动使用所属组颜色 |
| 💾 自动保存 | 修改颜色后即时保存至数据库，无需刷新 |
| 🧱 兼容 HydroOJ v5.0.0-beta.9+ |

---

## 🗂️ 文件结构

```
addons/
 └─ hydro-namecolor/
     ├─ package.json
     ├─ index.js
     ├─ views/
     │   └─ admin_namecolor.pug
     └─ frontend/
         └─ colorpicker.js
```

---

## ⚙️ 安装步骤

1. **下载插件代码**

   将整个文件夹放入 HydroOJ 的 `addons/` 目录：
   ```
   addons/hydro-namecolor/
   ```

2. **启用插件**
   ```bash
   node cli addon enable hydro-namecolor
   node cli restart
   ```

3. **打开管理页面**

   登录管理员账号后访问：
   ```
   /admin/namecolor
   ```

---

## 🧭 使用指南

### 1️⃣ 设置单个用户颜色

- 在表单中输入用户名或 UID（支持自动补全）  
- 选择颜色或手动输入 HEX 值  
- 点击「修改颜色」即可立即应用  
- 下方预览框实时展示效果  

### 2️⃣ 批量设置用户组颜色

- 在“用户组颜色”表中，点击对应颜色框  
- 选择颜色后自动保存，无需刷新  
- 所有属于该组的用户（未设置个人颜色）将自动继承组颜色  

### 3️⃣ 内联快速修改

- “当前用户颜色”表中的颜色框支持直接点击修改  
- 颜色更改后会自动保存到数据库  
- 光标变灰表示正在保存，完成后恢复正常  

---

## 🧩 数据结构扩展

该插件自动为数据库模型增加以下字段：

| 模型 | 新增字段 | 类型 | 默认值 |
|------|-----------|------|--------|
| `UserModel` | `name_color` | String | `''` |
| `GroupModel` | `name_color` | String | `''` |

无需手动修改数据库结构。

---

## 🎨 效果示例

| 用户名 | 所属组 | 最终显示颜色 |
|---------|----------|--------------|
| `Tom` | `管理员` | 🔴 红色（管理员组颜色） |
| `Alice` | `出题人` | 🔵 蓝色（组颜色） |
| `Bob` | `普通用户` | ⚫ 黑色（个人颜色覆盖组颜色） |

> 若用户未设置个人颜色，则自动使用所属组颜色。  

---

## 🔐 权限控制

- 所有 `/admin/namecolor*` 路由均受管理员权限限制  
- 非管理员访问会自动重定向至主页  

---

## 🧰 技术说明

- 使用 `utils.extend('render_user', …)` 扩展用户名渲染逻辑  
- 支持用户组优先级继承逻辑：  
  ```
  用户颜色 > 用户组颜色 > 默认颜色
  ```
- 所有请求均通过 AJAX 或安全 POST 表单提交  
- 无需修改核心代码，独立插件加载  

---

## 🧪 兼容性

| HydroOJ 版本 | 状态 |
|---------------|--------|
| ≥ 5.0.0-beta.9 | ✅ 完全兼容 |
| < 5.0.0-beta.9 | ⚠️ 可能不兼容（API 差异） |

---

## 🧑‍💻 作者信息

- **作者**：Fialia9363 
- **版本**：1.0.0  
- **许可证**：MIT  
- **兼容系统**：HydroOJ >= v5.0.0-beta.9  
- **最后更新**：2025年10月

---

## 🪄 截图示意（文字版）

```
管理员设置用户名字颜色
──────────────────────────────
用户名或UID：[  Alice       ]  
颜色：[#0000ff]  🎨  
预览效果：Alice

[ 修改颜色 ]

──────────────────────────────
当前用户颜色列表
UID        用户名      当前颜色
12345678   Alice       🔵 #0000ff
22334455   Bob         ⚫ #000000

──────────────────────────────
用户组颜色列表
组ID       组名        当前颜色
001        管理员      🔴 #ff0000
002        出题人      🔵 #0000ff
003        普通用户    ⚫ #000000
```

---

## 🧩 卸载方法

```bash
node cli addon disable hydro-namecolor
node cli restart
```

数据库字段会被保留，不影响原数据。

---

## 💬 支持与反馈

如需帮助或建议，可联系作者 Armsoftware  
或提交 Issue 以便改进插件功能。
